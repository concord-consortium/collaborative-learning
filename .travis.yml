sudo: false
dist: trusty
language: node_js
node_js: lts/*
cache:
  bundler: true
  pip: true
  directories:
    - "$HOME/.npm"
    - "$HOME/.cache"
# cf. https://stackoverflow.com/a/52387639
install:
- travis_retry gem install s3_website -v 3.4.0
- travis_retry pip install awscli --upgrade --user
- travis_retry npm ci
jobs:
  include:
  - stage: "Tests"
    name: "unit test"
    env:
      - STAGE_NAME="unit tests"
    script:
      - npm run test:coverage -- --runInBand --forceExit
  - stage: "Integration Tests"
    name: "integration test 1"
    env:
      - STAGE_NAME="integration-electron"
    script:
      - ./cypress/run_cypress_test.sh $STAGE_NAME
  - name: "integration test 2" 
    env:
      - STAGE_NAME="integration-electron"
    script:
      - ./cypress/run_cypress_test.sh $STAGE_NAME
  - name: "integration test 3" 
    env:
      - STAGE_NAME="integration-electron"
    script:
      - ./cypress/run_cypress_test.sh $STAGE_NAME
  - name: "integration test 4" 
    env:
      - STAGE_NAME="integration-electron"
    script:
      - ./cypress/run_cypress_test.sh $STAGE_NAME
  - stage: "Deploy"
    name: "deploy"
    script:
      - npm run build
      - ./s3_deploy.sh
      - ./rollbar_deploy.sh 